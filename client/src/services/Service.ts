import IService from "./IService";
import { IContactModel } from "../models/IContactModel";

export default class Service implements IService {

    contacts: Array<IContactModel> = [
        {
            contact_id: 1,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 2,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 3,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 4,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 5,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 6,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 7,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 8,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 9,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 10,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 11,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 12,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 13,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 14,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 15,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 16,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 17,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 18,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 19,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 20,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 21,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 22,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 23,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        },
        {
            contact_id: 24,
            name: "David",
            surname: "Aleu",
            image_url: "https://cdn2.iconfinder.com/data/icons/ios-7-icons/50/user_male2-512.png",
            address: "C/Major nº3",
            telephone: "2331212312",
            email: "danefi@gege.com"
        }
    ];

    public getContacts(): Promise<Array<IContactModel>> {
        return new Promise<Array<IContactModel>>((resolve, reject)=>{
            let headers = new Headers();        

            fetch("https://agenda.hackfromhome.hackersatupc.org/api/contacts",{
                headers: headers,
                method: 'GET',
            })
            .then(response=>{
                response.json()
                .then(data=>{

                    let contacts = new Array<IContactModel>();
                    data.response.contact_list.forEach((contact:any) => {
                        let newContact: IContactModel = {
                            contact_id: contact.id,
                            image_url: contact.image_url,
                            name: contact.name,
                            surname: contact.last_name,
                            address: contact.address,
                            telephone: contact.phone_number,
                            email: contact.email
                        }
                        contacts.push(newContact);
                    });

                    resolve(contacts);
                });
            })
            .catch(error=>{
                reject(error);
            })
        });
    }

    public createContact(contact: IContactModel): Promise<string> {
        return new Promise<string>((resolve, reject)=>{
            let body = {
                "address": contact.address,
                "email": contact.email,
                "image_url": "https://urgentcarekids.com/wp-content/uploads/2020/03/Coronavirus.png",
                "last_name": contact.surname,
                "name": contact.name,
                "phone_number": contact.telephone
              };

            let jsonBody = JSON.stringify(body);

            fetch("https://agenda.hackfromhome.hackersatupc.org/api/contacts",{
                method: 'POST',
                body:jsonBody,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                  }
            })
            .then(response=>{
                response.json()
                .then(data=>{
                    console.log(data);
                    if(data.error){
                        reject(data.error.message);
                    }
                    else {
                        resolve(data.response);
                    }
                });
            })
            .catch(error=>{
                reject(error);
            })
        });
    }

    public updateContact(contact: IContactModel): Promise<string> {
        return new Promise<string>((resolve, reject)=>{
            let body = {
                "address": contact.address,
                "email": contact.email,
                "last_name": contact.surname,
                "name": contact.name,
                "phone_number": contact.telephone
              };

            let jsonBody = JSON.stringify(body);

            fetch("https://agenda.hackfromhome.hackersatupc.org/api/contacts?contact_id="+contact.contact_id,{
                method: 'PUT',
                body:jsonBody,
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                  }
            })
            .then(response=>{
                response.json()
                .then(data=>{
                    console.log(data);
                    if(data.error){
                        reject(data.error.message);
                    }
                    else {
                        resolve(data.response);
                    }
                });
            })
            .catch(error=>{
                reject(error);
            })
        });
    }

    public deleteContact(contact_id: number): Promise<string> {
        return new Promise<string>((resolve, reject)=>{
            fetch("https://agenda.hackfromhome.hackersatupc.org/api/contacts?contact_id="+contact_id,{
                method: 'DELETE',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                  }
            })
            .then(response=>{
                response.json()
                .then(data=>{
                    console.log(data);
                    if(data.error){
                        reject(data.error.message);
                    }
                    else {
                        resolve(data.response);
                    }
                });
            })
            .catch(error=>{
                reject(error);
            })
        }); 
    }
}